<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <style>
    select, textarea {
      width: 100%;
      margin-bottom: 10px;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    #usageNotice { font-size:14px; color:#444; margin-bottom:10px; }
    #message     { color:red; margin-bottom:10px; }
  </style>
</head>
<body>
  <div id="message"></div>
  <div id="usageNotice"></div>

  <select id="companion">
    <option disabled selected value="">誰と？</option>
    <option value="一人">一人</option>
    <option value="カップル">カップル</option>
    <option value="家族">家族</option>
  </select>

  <select id="preference">
    <option disabled selected value="">どんな好み？</option>
    <option value="名物が食べたい">名物が食べたい</option>
    <option value="さっぱり系が好き">さっぱり系が好き</option>
    <option value="ガッツリ食べたい">ガッツリ食べたい</option>
  </select>

  <select id="mood">
    <option disabled selected value="">気分は？</option>
    <option value="お祝い気分">お祝い気分</option>
    <option value="ゆっくりしたい">ゆっくりしたい</option>
    <option value="お酒と楽しみたい">お酒と楽しみたい</option>
  </select>

  <textarea id="freeInput" rows="2" placeholder="補足あれば"></textarea>

  <script>
    const urlParams  = new URLSearchParams(window.location.search)
    const qDate      = urlParams.get('date')
    const today      = new Date().toISOString().slice(0,10)
    const usageKey   = `usage_${today}`
    const count      = parseInt(localStorage.getItem(usageKey) || '0', 10)
    const noticeEl   = document.getElementById('usageNotice')
    const messageEl  = document.getElementById('message')

    if (!qDate || qDate !== today) {
      messageEl.textContent = 'このURLの有効期限は切れています。QRを読み取り直してください。'
    } else {
      noticeEl.textContent = `利用回数：残り${Math.max(0,3-count)}回`
    }
  </script>
</body>
</html>
